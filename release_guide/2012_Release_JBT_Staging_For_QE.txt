== Publishing JBT update sites for QE ==

=== Builds ===

1. Move the latest JBT, Web Tools, and SOA Tooling nightly builds (no symlinks to avoid accidental cleanup):

	version=4.0.0.CR1e # a, b, c...
	branch=core/4.0.juno
	buildID1=$(echo "ls 20*" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds/nightly/${branch} 2>&1 | grep "20.\+" | grep -v sftp | sort | tail -1); buildID1=${buildID1%%/*}
	echo "Latest build: ${buildID1}"
	echo "mkdir development/${version}.core" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
	echo "rename nightly/${branch}/${buildID1} development/${version}.core/${buildID1}" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
	
	branch=webtools/4.0.juno
	buildID3=$(echo "ls 20*" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds/nightly/${branch} 2>&1 | grep "20.\+" | grep -v sftp | sort | tail -1); buildID3=${buildID3%%/*}
	echo "Latest build: ${buildID3}"
	echo "mkdir development/${version}.webtools" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
	echo "rename nightly/${branch}/${buildID3} development/${version}.webtools/${buildID3}" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/builds
	
	echo " >> http://download.jboss.org/jbosstools/builds/development/${version}.core/${buildID1}" | egrep ">>|${version}"
	echo " >> http://download.jboss.org/jbosstools/builds/development/${version}.webtools/${buildID3}" | egrep ">>|${version}"

=== Update Sites ===

2. Move the latest JBT, Web Tools, and SOA Tooling update sites (no symlinks to avoid accidental overwrites):

	version=4.0.0.CR1e # a, b, c...
	branch=core/4.0.juno; 	echo "rename nightly/${branch} JBossTools-${version}.core" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates	
	echo " >> http://download.jboss.org/jbosstools/updates/JBossTools-${version}.core/" | egrep ">>|${version}"

	branch=webtools/4.0.juno; 	echo "rename nightly/${branch} JBossTools-${version}.webtools" | sftp tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates
	echo " >> http://download.jboss.org/jbosstools/updates/JBossTools-${version}.webtools/" | egrep ">>|${version}"

3. To preserve a copy of the nightly sites after the move:

	ssh to dev01.mw.lab.eng.bos.redhat.com, sudo to hudson user, then
 
	alias   scpr='rsync -aPrz --rsh=ssh --protocol=28'

	version=4.0.0.CR1e # a, b, c...
	branch=core/4.0.juno
	scpr tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates/JBossTools-${version}.core/* /tmp/JBossTools-${version}.core/
	scpr /tmp/JBossTools-${version}.core/* tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates/nightly/${branch}/ --delete
	rm -fr /tmp/JBossTools-${version}.core/
	echo " >> http://download.jboss.org/jbosstools/updates/nightly/${branch}/" | egrep ">>|${branch}"

	branch=webtools/4.0.juno
	scpr tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates/JBossTools-${version}.webtools/* /tmp/JBossTools-${version}.webtools/
	scpr /tmp/JBossTools-${version}.webtools/* tools@filemgmt.jboss.org:/downloads_htdocs/tools/updates/nightly/${branch}/ --delete
	rm -fr /tmp/JBossTools-${version}.webtools/
	echo " >> http://download.jboss.org/jbosstools/updates/nightly/${branch}/" | egrep ">>|${branch}"

---

Note that 
	sftp://tools@filemgmt.jboss.org/downloads_htdocs/tools/ 
		maps to 
	http://download.jboss.org/jbosstools/

If you don''t need it urgently, you can push files there simply by committing changes to SVN here:

	http://anonsvn.jboss.org/repos/jbosstools/trunk/download.jboss.org/jbosstools/

This is controlled by Hudson job here:

	https://jenkins.mw.lab.eng.bos.redhat.com/hudson/view/DevStudio/view/DevStudio_All/job/jbosstools-download.jboss.org-rsync-from-svn/
	
--------------------------------------------

== EMAIL TEMPLATES ==

SEND 2 emails: 
1 to jbosstools-dev, and 
1 to interal addresses (to avoid accidentally sending internal info to external address)

# 1. To: 	"jbosstools-dev@lists.jboss.org"
# 2. To:  jbds-pm-list <jbds-pm-list@redhat.com>, "external-exadel-list@redhat.com" <external-exadel-list@redhat.com>

version=4.0.0.CR1e # a, b, c...
respin="respin-e"

echo "
Subject: 

JBoss Tools Core ${version} bits available for QE testing

Body:

As always, these are not FINAL bits, but preliminary results for QE testing. Not for redistribution to customers. 

Update Sites:

http://download.jboss.org/jbosstools/updates/JBossTools-${version}.core/
http://download.jboss.org/jbosstools/updates/JBossTools-${version}.webtools/

Builds:

http://download.jboss.org/jbosstools/builds/development/${version}.core/${buildID1}
http://download.jboss.org/jbosstools/builds/development/${version}.webtools/${buildID3}

JBoss Central:

To test this version of Central, add this to your eclipse.ini file after the -vmargs line:

-Djboss.discovery.directory.url=http://download.jboss.org/jbosstools/updates/JBossTools-${version}.core/jbosstools-directory.xml

New + Noteworthy:

Subject to change, the latest N&N is here:

http://htmlpreview.github.com/?https://raw.github.com/jbosstools/jbosstools-documentation/master/whatsnew/index.html

Changes prompting this $respin are:
"'
https://issues.jboss.org/secure/IssueNavigator!executeAdvanced.jspa?jqlQuery=labels+in+%28'${respin}'%29+and+project+in+%28JBDS%2C+JBIDE%2C+TOOLSDOC%29+and+fixversion+in+%28%224.0.0.CR1%22%2C+%226.0.0.CR1%22%29&runQuery=true&clear=true
'
